{% extends "layout/base.html" %}
{% load static %}
{% block title %}AI ì²¨ì‚­ ê²°ê³¼{% endblock title %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">

        <div class="col-lg-8">
            <h2 class="mb-4">ğŸ¤– AI ë©˜í†  ì²¨ì‚­ ê²°ê³¼</h2>

            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-info-subtle"><strong>ğŸ‘¨â€ğŸ“ í•™ìƒ ë‹µì•ˆ (OCR ë³€í™˜)</strong></div>
                        <div class="card-body"><textarea class="form-control answer-textarea" readonly>{{ student_answer }}</textarea></div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-warning-subtle"><strong>âœ… ëª¨ë²” ë‹µì•ˆ</strong></div>
                        <div class="card-body"><textarea class="form-control answer-textarea" readonly>{{ model_answer }}</textarea></div>
                    </div>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-header"><strong>âœ¨ ë…¼ë¦¬ì™• ê¹€ë©˜í† 's ì½”ë©˜íŠ¸</strong></div>
                <div class="card-body">
                    {{ main_comment_html|safe }}
                    {% if suggestions %}
                        <h4 class="mt-4">ğŸ’¡ ì´ë ‡ê²Œ ë°”ê¿”ë³´ì„¸ìš”</h4>
                        <div class="accordion" id="suggestionAccordion">
                            {% for item in suggestions %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                                        <strong>ìˆ˜ì • ì œì•ˆ #{{ forloop.counter }}:</strong>Â  "{{ item.original|truncatechars:50 }}"
                                    </button>
                                </h2>
                                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse show">
                                    <div class="accordion-body">
                                        <p class="text-muted"><strong>í•™ìƒ ì›ë¬¸:</strong> "{{ item.original }}"</p>
                                        <p><strong>ìˆ˜ì • ì œì•ˆ:</strong> "{{ item.diff_html|safe }}"</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    {% if final_comment_html %}
                        <div class="p-3 bg-light rounded mt-4">
                            {{ final_comment_html|safe }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div id="fixed-chat-container">
                <div class="card">
                    <div class="card-header"><strong><i class="bi bi-chat-dots-fill"></i>AI ì±—ë´‡</strong></div>
                    <div class="card-body d-flex flex-column p-2">
                        <!-- ì±„íŒ… ë©”ì‹œì§€ê°€ í‘œì‹œë  ì˜ì—­ -->
                        <div id="chat-history" class="flex-grow-1 p-2" style="overflow-y: auto;">
                            <div class="chat-message ai-message">
                                ì²¨ì‚­ ê²°ê³¼ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ì§ˆë¬¸í•´ë³´ì„¸ìš”!
                            </div>
                        </div>
                        <!-- ë©”ì‹œì§€ ì…ë ¥ í¼ -->
                        <form id="chat-form" class="mt-auto p-2 d-flex" data-submission-id="{{ submission.id }}">
                            {% csrf_token %}
                            <input type="text" id="chat-input" class="form-control" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" required>
                            <button type="submit" class="btn btn-primary ms-2"><i class="bi bi-arrow-up"></i></button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

{% block script %}
<script src="{% static 'js/chat.js' %}"></script>
{% endblock script %}